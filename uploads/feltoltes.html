<!DOCTYPE HTML>
<html lang="hu">
    <head>
		<title>Megoszt√≥ - Hausz</title>
		<meta charset="UTF-8">
        <meta name="description" content="F√°jl megoszt√≥ szolg√°ltat√°s, ahol a felhaszn√°l√≥k priv√°t √©s publikus m√≥don tudnak f√°jlokat megosztani egym√°ssal.">
		<link rel="stylesheet" type="text/css" href="/index/style.css" />
        <link rel="stylesheet" type="text/css" href="/index/alapok.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/png" href="/index/favicon.png"/>
        <script type='application/ld+json'>
            {
                "@context": "https://www.schema.org",
                "@type": "product",
                "brand": {
					"@type": "Brand",
					"name": "Hausz"
				}
                "logo": "/index/favicon.png",
                "name": "WidgetPress",
                "category": "Widgets",
                "image": "/index/favicon.png",
                "description": "A Hausz Kft. megoszt√≥ szolg√°ltat√°sa, ahol f√°jlokat lehet megosztani priv√°t √©s publikus m√≥don, anonim √©s regisztr√°lt felhaszn√°l√≥k √°ltal egyar√°nt.",
                "aggregateRating": {
                    "@type": "aggregateRating",
                    "ratingValue": "5",
                    "reviewCount": "69"
                }
            }
        </script>
	</head>
    <body>
        <span id="belepteto_rendszer"></span>
        <script src="/include/topbar.js"></script>
        <script src="/include/alap_fuggvenyek.js"></script>
        <script type="module" src="/include/belepteto_rendszer.js"></script>
        <script>
            var session_username = "";
            var session_admin = "";
            var session_loggedin = "";

            function belepes_siker() {
                document.getElementById('privat_doboz').style.display = 'block';
            }
            
            function kilepes_siker() {
                session_admin = '';
                session_loggedin = '';
                session_username = '';
                document.getElementById('privat_doboz').style.display = 'block';
            }
            
            function belepteto_rendszer_frissult() {
                fajlok_betoltese_js();
            }
            
            function fajlok_betoltese_js() {
                buffer = '<tr><th class="mobilon-tiltas"></th><th>F√°jln√©v</th><th class="mobilon-tiltas">D√°tum</th><th class="mobilon-tiltas">M√©ret</th><th class="mobilon-tiltas">Felt√∂lt≈ë</th><th class="mobilon-tiltas" colspan="4"><a onclick=\'szinkron_keres((uzenet) => { fajlok_betoltese_js(); }, "/uploads/feltoltes.php", "fajlok");\'>üîÉ Friss√≠t√©s</a></th></tr>';
                szinkron_keres((uzenet) => {
                    sorok = uzenet.replace(/^</, '');
                    sorok = sorok.replace(/>$/, '');
                    sorok = sorok.split('><');
                    sorok.forEach(sor => {
                        elemek = sor.split('|');
                        
                        id = elemek[0];
                        size = elemek[1];
                        filename = elemek[2];
                        added = elemek[3];
                        username = elemek[4];
                        private = elemek[5];
                        titkositott = elemek[6];

                        // EMOJI IKON
                        kiterjesztes = filename.replace(/(.*)(\..*)/, '$2');
                        elonezet_tipus = "egy√©b";

                        kep_regexek =           [   /\.jpg$/i, /\.png$/i, /\.heic$/i, /\.gif$/i, /\.svg$/i, /\.webp$/i, /\.bmp$/i, /\.jpeg$/i,  ]
                        audio_regexek =         [   /\.mp3$/i, /\.wav$/i ]
                        video_regexek =         [   /\.mkv$/i, /\.avi$/i, /\.mp4/i, /\.webm/i ]
                        dokumentum_regexek =    [   /\.pdf$/i, /\.c$/i, /\.cpp$/i, /\.m$/i, /\.py$/i, /\.css$/i, /\.txt$/i, /\.sql$/i, 
                                                    /\.xls$/i, /\.xlsx$/i, /\.doc$/i, /\.docx$/i, /\.ppt$/i, /\.pptx$/i, /\.ahk$/i, 
                                                    /\.md$/i ]     
                        szoftver_regexek =      [   /\.exe$/i, /\.msi$/i, /\.iso$/i, /\.apk$/i, /\.rpm$/i, /\.deb$/i, /\.dmg$/i, /\.pkg$/i ]
                        csomagolt_regexek =     [   /\.torrent$/i, /\.zip$/i, /\.7z$/i, /\.tar$/i, /\.rar$/i, /\.gz$/i,  ]
                        
                        kep_regexek.forEach( kep_regex => { if( kep_regex.test(kiterjesztes) ) {   elonezet_tipus = "kep"; } });
                        audio_regexek.forEach( audio_regex => { if( audio_regex.test(kiterjesztes) ) {   elonezet_tipus = "audio"; } });
                        video_regexek.forEach( video_regex => { if( video_regex.test(kiterjesztes) ) {   elonezet_tipus = "video"; } });
                        dokumentum_regexek.forEach( dokumentum_regex => { if( dokumentum_regex.test(kiterjesztes) ) {   elonezet_tipus = "dokumentum"; } });
                        szoftver_regexek.forEach( szoftver_regex => { if( szoftver_regex.test(kiterjesztes) ) {   elonezet_tipus = "szoftver"; } });
                        csomagolt_regexek.forEach( csomagolt_regex => { if( csomagolt_regex.test(kiterjesztes) ) {   elonezet_tipus = "csomagolt"; } });
                        
                        
                        buffer += '<tr>';
                        if( titkositott == '1') {
                            buffer += '<tr onclick=\'titkositas_feloldasa('+id+', "'+filename+'")\'>';
                        } else {
                            buffer += '<tr onclick=\'elonezet("https://hausz.stream/uploads/request.php?file_id='+id+'", "'+elonezet_tipus+'", '+size+')\'>';
                        }

                        buffer += '<td class="mobilon-tiltas">';
                        switch (elonezet_tipus) {
                            case "kep": buffer          += '<abbr style="cursor: pointer" title="K√©p">üì∑</abbr>'; break;
                            case "audio": buffer        += '<abbr style="cursor: pointer" title="Audi√≥">üéµ</abbr>'; break;
                            case "video": buffer        += '<abbr style="cursor: pointer" title="Vide√≥">üé¨</abbr>'; break;
                            case "dokumentum": buffer   += '<abbr style="cursor: pointer" title="Dokumentum">üìù</abbr>'; break;
                            case "szoftver": buffer     += '<abbr style="cursor: pointer" title="Szoftver">üíø</abbr>'; break;
                            case "csomagolt": buffer    += '<abbr style="cursor: pointer" title="Csomagolt f√°jl">üì¶</abbr>'; break;
                            default: buffer             += '<abbr style="cursor: pointer" title="Egy√©b">‚ùî</abbr>'; break;
                        }
                        buffer += '</td>';
                        
                        
                        // private? encrypted? n√©v
                        buffer += '<td>';
                        if( private == '1' ) {
                            buffer += '<abbr style="cursor: pointer" title="Priv√°t (csak te l√°tod)">üîí</abbr> ';
                        }
                        if( titkositott == '1' ) {
                            buffer += '<abbr style="cursor: pointer" title="Jelsz√≥val titkos√≠tott">üîë</abbr> ';
                        }
                        buffer += filename + '</td>';
                        
                        // D√ÅTUM 2022-04-19 19:34:14
                        buffer += '<td class="mobilon-tiltas">';
                        buffer += added.replace(/([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})/, '$1.$2.$3 $4:$5');
                        buffer += '</td>';

                        // M√âRET
                        meret = parseFloat(size);
                        if( meret <= 1024) {
                            meret = String(meret) + ' B';
                        } else {
                            if( meret <= 1024 * 1024) {
                                meret = String(meret / 1024) + ' KB';
                            } else {
                                if( meret <= 1024 * 1024 * 1024) {
                                    meret = String(meret / 1024 / 1024) + ' MB';
                                } else {
                                    if( meret <= 1024 * 1024 * 1024 * 1024) {
                                        meret = String(meret / 1024 / 1024 / 1024) + ' GB';
                                    } else {
                                        if( meret <= 1024 * 1024 * 1024 * 1024 * 1024) {
                                            meret = String(meret / 1024 / 1024  / 1024  / 1024) + ' GB';
                                        }
                                    }
                                }
                            }
                        }
                        meret = meret.replace(/([0-9])\.([0-9][0-9]).* ([KMG]?B)/, '$1.$2 $3');
                        meret = meret.replace(/([0-9][0-9])\.([0-9]).* ([KMG]?B)/, '$1.$2 $3');
                        meret = meret.replace(/([0-9][0-9][0-9])\..* ([KMG]?B)/, '$1 $2');
                        buffer += '<td class="mobilon-tiltas">' + meret + '</td>';
                        
                        // felt√∂lt≈ë
                        buffer += '<td class="mobilon-tiltas">' + username + '</td>';

                        // t√∂rl√©s? 
                        buffer += '<td class="mobilon-tiltas">';
                        if(session_username == username || (username == 'ismeretlen' && session_loggedin == 'yes')) {
                            buffer += '<a onclick="torles(\'/uploads/feltoltes.php?delete=1&file_id=' + id + '\', \''+`${filename}`+'\')"><abbr style="cursor: pointer" title="T√∂rl√©s">‚ùå</abbr></a>';
                        }
                        buffer += '</td>';

                        // √°tnevez√©s?
                        buffer += '<td class="mobilon-tiltas">';
                        if(session_username == username) {
                            buffer += '<a onclick="fajl_atnevezese(' +id+', \''+`${filename}`+'\')"><abbr style="cursor: pointer" title="√Åtnevez√©s">‚úèÔ∏è</abbr></a>';
                        }
                        buffer += '</td>';   

                        // ment√©s?
                        buffer += '<td class="mobilon-tiltas">';
                        if( titkositott != '1' ) {
                            buffer += '<a href="/uploads/request.php?file_id=' + `${id}` + '"><abbr style="cursor: pointer" title="Let√∂lt√©s">üíæ</abbr></a>';
                        }
                        buffer += '</td>';
                    });
                    document.getElementById('tablazat').innerHTML = buffer;
                }, "/uploads/feltoltes.php", "fajlok_javascript");
                
            }

            function torles(link, fajlnev) {
                if( confirm('Biztosan szeretn√©d t√∂r√∂lni a "' + fajlnev + '" nev≈± f√°jlt?') ) {
                    szinkron_keres((uzenet) => {
                        if(/^OK:/.test(uzenet)) {
                            valasz = uzenet.replace(/^OK:/, '');
                            uj_valasz_mutatasa(valasz);
                            fajlok_betoltese_js();
                            tablazat_kiirasa();
                        } else {
                            valasz = uzenet.replace(/^HIBA:/, 'HIBA: ');
                            alert(valasz);
                        }
                    }, link);
                }
            }

            function elonezet(hivatkozas, tipus, meret) {
                var caller = event.target;
                if(caller.outerHTML.match(/^<td/) ) {
                    if(meret > 1024*1024*2) {
                        alert('A f√°jl m√©rete nagyobb mint 2MB, ez√©rt az el≈ën√©zetet nem lehet hozz√° bet√∂lteni. Am√∫gy esk√º az√©rt mert egy fizikai limit√°ci√≥, √©s v√©letlen√ºl sem az√©rt mert sp√≥rolni akarok az elk√ºld√∂tt adatmennyis√©g k√∂lts√©g√©n xdddd√°≈±');
                    } else {
                        document.getElementById('preview_box').style.visibility = '';
                        document.getElementById('darken_background').style.visibility = '';
                        document.getElementById('elonezet_bezaras_gomb').style.visibility = '';
                        
                        if(tipus == "kep") {
                            document.getElementById('preview_box').innerHTML = '<img alt="el≈ën√©zet" id="elonezet_iframe" src="' + hivatkozas + '" title="El≈ën√©zet" />';
                            return;
                        }
                        if(tipus == "audio") {
                            document.getElementById('preview_box').innerHTML = '<audio controls><source src="'+hivatkozas +'" type="audio/mpeg" /></audio>';
                            return;
                        }

                        document.getElementById('preview_box').innerHTML = '<iframe style="height: 100%; width: 100%" id="elonezet_iframe" src="' + hivatkozas + '" title="El≈ën√©zet"></iframe>';
                        document.getElementById('preview_box').style.height = '100%';
                        document.getElementById('preview_box').style.width = '80%';
                    }
                }
            }

            function titkositas_feloldasa(file_id, fajlnev) {
                var caller = event.target;
                if( !caller.outerHTML.match(/^<td/) ) {
                    return;
                }
                document.getElementById('titkositatlan_fajl_letoltes_link').innerHTML = "";
                document.getElementById('titkositas_feloldasa_kulcs').value = "";

                document.getElementById('titkositott_fajl_letoltes_link').innerHTML = "<br><br>Titkos√≠tott f√°jl let√∂lt√©se";
                document.getElementById('titkositott_fajl_letoltes_link').download = "titkositott_" + fajlnev;
                document.getElementById('titkositott_fajl_letoltes_link').href = "https://hausz.stream/uploads/request.php?file_id=" + file_id;
                document.getElementById('titkositas_feloldasa_box').style.visibility = '';
                document.getElementById('darken_background').style.visibility = '';
                document.getElementById('elonezet_bezaras_gomb').style.visibility = '';
                document.getElementById('titkositas_feloldasa_kuldes_gomb').onclick = function() { 
                    titkositas_feloldasa_kuldes(file_id, fajlnev, caller);
                };
            }

            function titkositas_feloldasa_kuldes(file_id, fajlnev, caller) {
                if(document.getElementById('titkositas_feloldasa_kulcs').value.length <= 0) {
                    alert("Nem adt√°l meg titkos√≠t√°si kulcsot, √≠gy nem lehet feloldani a f√°jlt.");
                    return;
                }
                
                let keres = new XMLHttpRequest();
                keres.onload = function() {
                    if(/^OK:/.test(this.responseText)) {
                        uj_valasz_mutatasa("F√°jl let√∂lt√©se...");
                        var xhr = new XMLHttpRequest();
                        xhr.open('POST', "/uploads/request.php?file_id=" + file_id);
                        xhr.responseType = 'blob';
                        xhr.onload = function() {
                            fajl = xhr.response;
                            link = URL.createObjectURL(fajl);
                            document.getElementById('titkositatlan_fajl_letoltes_link').href = link;
                            document.getElementById('titkositatlan_fajl_letoltes_link').innerHTML = "<br><br>Titkos√≠tatlan f√°jl let√∂lt√©se";
                            document.getElementById('titkositatlan_fajl_letoltes_link').download = fajlnev;
                            uj_valasz_mutatasa("F√°jl let√∂lt√©se k√©sz.");
                        };
                        let formData_letoltes = new FormData();
                        formData_letoltes.append("letoltes", "1");
                        formData_letoltes.append("titkositas_feloldasa_kulcs", document.getElementById('titkositas_feloldasa_kulcs').value);
                        xhr.send(formData_letoltes);
                    }
                    if(/^HIBA:/.test(this.responseText)) {
                        uj_valasz_mutatasa(this.responseText);
                    }
                }
                let formData = new FormData();
                formData.append("titkositas_feloldasa_kulcs", document.getElementById('titkositas_feloldasa_kulcs').value);
                keres.open("POST", "/uploads/request.php?file_id=" + file_id);
                keres.send(formData);
            }

            function fajl_atnevezese(id, fajlnev) {
                console.log(id +' '+ fajlnev);
                document.getElementById('atnevezes_box').style.visibility = '';
                document.getElementById('darken_background').style.visibility = '';
                document.getElementById('elonezet_bezaras_gomb').style.visibility = '';
                document.getElementById('atnevezes_uj_nev').placeholder = fajlnev;
                document.getElementById('atnevezes_uj_nev').value = fajlnev;
                document.getElementById('atnevezes_uj_nev').azonosito = id;
            }

            function uj_valasz_mutatasa(valasz) {
                document.getElementById('valasz_uzenet').innerHTML = "<p>" + valasz + "</p>";
                document.getElementById('valasz_uzenet').style.opacity = "100%";
                uj_valasz_mutatasa_idozito = setTimeout(() => {
                    document.getElementById('valasz_uzenet').style.opacity = "0%";
                }, 5000);
            }

            function atnevezes_inditasa() {
                elonezet_bezaras();
                link = "/uploads/feltoltes.php?atnevezes=1&file_id=" + document.getElementById('atnevezes_uj_nev').azonosito + "&uj_nev=" + document.getElementById('atnevezes_uj_nev').value;
                szinkron_keres((uzenet) => {
                    if(/^OK:/.test(uzenet)) {
                        valasz = uzenet.replace(/^OK:/, '');
                        uj_valasz_mutatasa(valasz);
                        fajlok_betoltese_js();
                        tablazat_kiirasa();
                    } else {
                        alert(uzenet);
                    }
                }, link);
            }

            function claimeles(link) {
                szinkron_keres((uzenet) => {
                    if(/^OK:/.test(uzenet)) {
                        valasz = uzenet.replace(/^OK:/, '');
                        uj_valasz_mutatasa(valasz);
                        fajlok_betoltese_js();
                        tablazat_kiirasa();
                    } else {
                        alert(uzenet);
                    }
                }, link);
            }

            function feltoltes() {
                let fajl = document.getElementById("fileToUpload").files[0];
                let keres = new XMLHttpRequest();
                keres.onload = function() {
                    if(/^OK:/.test(this.responseText)) {
                        valasz = this.responseText.replace(/^OK:/, '');
                        uj_valasz_mutatasa(valasz);
                        fajlok_betoltese_js();
                        tablazat_kiirasa();
                    }
                }
                let formData = new FormData();
                if(document.getElementById('titkositas_kulcs').value.length > 0) {
                    formData.append("titkositas_kulcs", document.getElementById('titkositas_kulcs').value);
                }
                if( document.getElementById('private') != null ) {
                    if(document.getElementById('private').checked) {
                        formData.append("private", "1");
                    }
                }
                formData.append("fileToUpload", fajl);
                formData.append("submit", "1");
                keres.open("POST", '/uploads/feltoltes.php');
                keres.send(formData);
            }

            function elonezet_bezaras() {
                document.getElementById('preview_box').style.visibility = 'hidden';
                document.getElementById('atnevezes_box').style.visibility = 'hidden';
                document.getElementById('darken_background').style.visibility = 'hidden';
                document.getElementById('elonezet_bezaras_gomb').style.visibility = 'hidden';
                document.getElementById('titkositas_feloldasa_box').style.visibility = 'hidden';
                document.getElementById('preview_box').innerHTML = "";
            }

            function updateFileName() {
                document.getElementById('fileToUpload_label').innerHTML = "&#128193; "+ document.getElementById('fileToUpload').files[0].name;
                document.getElementById('SubmitGomb').style.visibility = '';
            }
        </script>
        <div id="valasz_uzenet" class="bottom_left_corner_div" style="z-index: 2; left: 5px; max-width: 10%; opacity: 0%;"></div>

        <div id='preview_box' class="preview_box" style="max-width: 60%; max-height: 60%;display: inline-block; visibility: hidden"></div>

        <div id='atnevezes_box' class="preview_box center" style="max-width: 60%; max-height: 60%;display: inline-block; visibility: hidden">
            <h3>F√°jl √°tnevez√©se</h3>
            <label for="atnevezes_uj_nev">Add meg a f√°jl √∫j nev√©t (kiterjeszt√©ssel egy√ºtt)</label><br><br>
            <input type="text" id="atnevezes_uj_nev" name="atnevezes_uj_nev" placeholder="" style="width: 100%"/><br><br><br>
            <button class="Gombok KekHatter" onclick="atnevezes_inditasa()">√Åtnevez√©s</button>
        </div>

        <div id='titkositas_feloldasa_box' class="preview_box center" style="max-width: 60%; max-height: 60%;display: inline-block; visibility: hidden">
            <h3>Az el√©rni k√≠v√°nt f√°jl titkos√≠tva van üîë</h3>
            <label for="titkositas_feloldasa_kulcs">Add meg a f√°jl titkos√≠t√≥ kulcs√°t a felold√°shoz</label><br><br>
            <input type="password" id="titkositas_feloldasa_kulcs" name="titkositas_feloldasa_kulcs" placeholder="Kulcs" style="width: 100%"/><br><br><br>
            <button class="Gombok KekHatter" id="titkositas_feloldasa_kuldes_gomb">Titkos√≠tott f√°jl felold√°sa</button>
            <a id="titkositott_fajl_letoltes_link" href="" download=""></a>
            <a id="titkositatlan_fajl_letoltes_link" href="" download=""></a>
        </div>
        <div id='darken_background' onclick="elonezet_bezaras()" style="visibility: hidden"> </div>
        <button id="elonezet_bezaras_gomb" onclick="elonezet_bezaras()" style="visibility: hidden">X</button>

        <h1 style="text-align: center">Megoszt√≥</h1>
        <p style="text-align: center">F√°jl megoszt√≥ szolg√°ltat√°s, ahol a felhaszn√°l√≥k priv√°t √©s publikus m√≥don tudnak f√°jlokat megosztani egym√°ssal.</p>
        <p style="text-align: center">T√∂lts fel egy f√°jlt, vagy n√©zd meg hogy m√°sok mit t√∂lt√∂ttek eddig fel.</p><br>
        
        <h2 style="text-align: center">Felt√∂lt√©s</h2>
        <form class="center" enctype="multipart/form-data">
            <label style="display: inline; width: 35%; margin:auto; font-size: 20px" for="fileToUpload" id="fileToUpload_label">&#128193; Kattints ide f√°jlok felt√∂lt√©s√©hez</label>
            <input onChange="updateFileName()" class="InputSzoveg" type="file" name="fileToUpload" id="fileToUpload">
            <div id="privat_doboz" style="display: none; margin-left: 10px; border-radius: 15px; font-size: 20px; display: inline; padding: 20px 10px; background-color: rgb(35, 35, 35);"><input type="checkbox" name="private" type="private" id="private" /><label for="private"> Priv√°t t√°rol√°s</label></div>
            <div id="titkositasi_kulcs_doboz" style="margin-left: 10px; border-radius: 15px; font-size: 20px; display: inline; padding: 20px 35px;">
            <label autocomplete="off" for="titkositas_kulcs">Titkos√≠t√°s kulcs: </label>
            <input autocomplete="off" type="password" name="titkositas_kulcs" type="titkositas_kulcs" id="titkositas_kulcs" /></div><br><br>
        </form>
        <br><br><button style="visibility: hidden; display: block; margin: auto" onclick="feltoltes()" class="Gombok KekHatter" id="SubmitGomb" hidden>Felt√∂lt√©s</button>
        
        <h2 style="text-align: center">Felt√∂lt√∂tt f√°jlok</h2>
        <table id="tablazat"></table>

        <h2 style="text-align: center">T√°rhely kihaszn√°lts√°ga</h2>
        <div class="div_szabad_tarhely" style="border: 1px solid black; border-radius: 10px; display: flex; width: 55%; height: auto; margin: auto">
            <div class="div_hasznalt_tarhely" id="div_hasznalt_tarhely" style="border-radius: 10px; padding: 10px; width:'.$foglalt_tarhely_arany.'%"><p id="hasznalt_tarhely">Felhaszn√°lt: </p></div>
            <div class="div_szabad_tarhely" id="div_szabad_tarhely" style="border-radius: 10px; padding: 10px; width:'.$szabad_tarhely_arany.'%; text-align: right"><p id="szabad_tarhely">Szabad ter√ºlet: </p></div>
        </div><br><br><br>

        <script>document.getElementById('szabad_tarhely').innerHTML = 'Szabad ter√ºlet: ".strval($szabad_tarhely)."';</script>
        <script>document.getElementById('hasznalt_tarhely').innerHTML = 'Felhaszn√°lt: ".strval($foglalt_tarhely)."';</script>
    </body>
</html>
